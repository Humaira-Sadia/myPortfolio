import{_ as de}from"./@babel-dGVwEr9R.js";import{r as y}from"./react-g8F3bhkl.js";import{L as Ee,T as At,R as Dt,U as Lt,a as Ft,O as Ie,P as ze,S as Xe,b as Pe,N as It,A as zt,B as Ht,M as Wt,C as Bt,V,c as $t,W as Nt,d as Gt,e as qt,f as Ut,g as Vt,h as Xt,i as Yt,D as Zt,j as he,k as He,l as Kt,E as it,m as Jt,n as Qt,o as en,p as tn}from"./three-ZJoahMlF.js";import{u as nn}from"./react-use-measure-V-qenG-1.js";import{F as rn,u as on}from"./its-fine-GrMTPjFU.js";import{R as sn,c as se}from"./react-reconciler-ru3UY2Kc.js";import{c as an}from"./react-dom-5ssvKcDh.js";import{c as st}from"./zustand-4FZFzYVJ.js";import{D as ln,G as We,a as cn,M as Me,O as un}from"./three-stdlib-4y44uqaL.js";import{m as fn}from"./react-merge-refs-hAbx5P3g.js";import{s as dn,p as pn,c as mn}from"./suspend-react-7rE_FwbT.js";var ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ar(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var a=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,a.get?a:{enumerable:!0,get:function(){return e[i]}})}),n}var at={exports:{}},lt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(w,x){var S=w.length;w.push(x);e:for(;0<S;){var T=S-1>>>1,O=w[T];if(0<a(O,x))w[T]=x,w[S]=O,S=T;else break e}}function n(w){return w.length===0?null:w[0]}function i(w){if(w.length===0)return null;var x=w[0],S=w.pop();if(S!==x){w[0]=S;e:for(var T=0,O=w.length,k=O>>>1;T<k;){var $=2*(T+1)-1,F=w[$],U=$+1,Z=w[U];if(0>a(F,S))U<O&&0>a(Z,F)?(w[T]=Z,w[U]=S,T=U):(w[T]=F,w[$]=S,T=$);else if(U<O&&0>a(Z,S))w[T]=Z,w[U]=S,T=U;else break e}}return x}function a(w,x){var S=w.sortIndex-x.sortIndex;return S!==0?S:w.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var u=performance;e.unstable_now=function(){return u.now()}}else{var h=Date,m=h.now();e.unstable_now=function(){return h.now()-m}}var s=[],g=[],r=1,o=null,f=3,p=!1,d=!1,P=!1,v=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,c=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(w){for(var x=n(g);x!==null;){if(x.callback===null)i(g);else if(x.startTime<=w)i(g),x.sortIndex=x.expirationTime,t(s,x);else break;x=n(g)}}function C(w){if(P=!1,b(w),!d)if(n(s)!==null)d=!0,N(M);else{var x=n(g);x!==null&&W(C,x.startTime-w)}}function M(w,x){d=!1,P&&(P=!1,l(A),A=-1),p=!0;var S=f;try{for(b(x),o=n(s);o!==null&&(!(o.expirationTime>x)||w&&!_());){var T=o.callback;if(typeof T=="function"){o.callback=null,f=o.priorityLevel;var O=T(o.expirationTime<=x);x=e.unstable_now(),typeof O=="function"?o.callback=O:o===n(s)&&i(s),b(x)}else i(s);o=n(s)}if(o!==null)var k=!0;else{var $=n(g);$!==null&&W(C,$.startTime-x),k=!1}return k}finally{o=null,f=S,p=!1}}var E=!1,j=null,A=-1,R=5,L=-1;function _(){return!(e.unstable_now()-L<R)}function D(){if(j!==null){var w=e.unstable_now();L=w;var x=!0;try{x=j(!0,w)}finally{x?B():(E=!1,j=null)}}else E=!1}var B;if(typeof c=="function")B=function(){c(D)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,H=X.port2;X.port1.onmessage=D,B=function(){H.postMessage(null)}}else B=function(){v(D,0)};function N(w){j=w,E||(E=!0,B())}function W(w,x){A=v(function(){w(e.unstable_now())},x)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(w){w.callback=null},e.unstable_continueExecution=function(){d||p||(d=!0,N(M))},e.unstable_forceFrameRate=function(w){0>w||125<w?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<w?Math.floor(1e3/w):5},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(s)},e.unstable_next=function(w){switch(f){case 1:case 2:case 3:var x=3;break;default:x=f}var S=f;f=x;try{return w()}finally{f=S}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(w,x){switch(w){case 1:case 2:case 3:case 4:case 5:break;default:w=3}var S=f;f=w;try{return x()}finally{f=S}},e.unstable_scheduleCallback=function(w,x,S){var T=e.unstable_now();switch(typeof S=="object"&&S!==null?(S=S.delay,S=typeof S=="number"&&0<S?T+S:T):S=T,w){case 1:var O=-1;break;case 2:O=250;break;case 5:O=1073741823;break;case 4:O=1e4;break;default:O=5e3}return O=S+O,w={id:r++,callback:x,priorityLevel:w,startTime:S,expirationTime:O,sortIndex:-1},S>T?(w.sortIndex=S,t(g,w),n(s)===null&&w===n(g)&&(P?(l(A),A=-1):P=!0,W(C,S-T))):(w.sortIndex=O,t(s,w),d||p||(d=!0,N(M))),w},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(w){var x=f;return function(){var S=f;f=x;try{return w.apply(this,arguments)}finally{f=S}}}})(lt);at.exports=lt;var Ye=at.exports;const Be={},vn=e=>void Object.assign(Be,e);function hn(e,t){function n(r,{args:o=[],attach:f,...p},d){let P=`${r[0].toUpperCase()}${r.slice(1)}`,v;if(r==="primitive"){if(p.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=p.object;v=oe(l,{type:r,root:d,attach:f,primitive:!0})}else{const l=Be[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");v=oe(new l(...o),{type:r,root:d,attach:f,memoizedProps:{args:o}})}return v.__r3f.attach===void 0&&(v instanceof Ht?v.__r3f.attach="geometry":v instanceof Wt&&(v.__r3f.attach="material")),P!=="inject"&&xe(v,p),v}function i(r,o){let f=!1;if(o){var p,d;(p=o.__r3f)!=null&&p.attach?Se(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),f=!0),f||(d=r.__r3f)==null||d.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,Le(o),ie(o)}}function a(r,o,f){let p=!1;if(o){var d,P;if((d=o.__r3f)!=null&&d.attach)Se(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"});const v=r.children.filter(c=>c!==o),l=v.indexOf(f);r.children=[...v.slice(0,l),o,...v.slice(l)],p=!0}p||(P=r.__r3f)==null||P.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=r,Le(o),ie(o)}}function u(r,o,f=!1){r&&[...r].forEach(p=>h(o,p,f))}function h(r,o,f){if(o){var p,d,P;if(o.__r3f&&(o.__r3f.parent=null),(p=r.__r3f)!=null&&p.objects&&(r.__r3f.objects=r.__r3f.objects.filter(C=>C!==o)),(d=o.__r3f)!=null&&d.attach)et(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var v;r.remove(o),(v=o.__r3f)!=null&&v.root&&Cn(o.__r3f.root,o)}const c=(P=o.__r3f)==null?void 0:P.primitive,b=!c&&(f===void 0?o.dispose!==null:f);if(!c){var l;u((l=o.__r3f)==null?void 0:l.objects,o,b),u(o.children,o,b)}if(delete o.__r3f,b&&o.dispose&&o.type!=="Scene"){const C=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Ye.unstable_scheduleCallback(Ye.unstable_IdlePriority,C):C()}ie(r)}}function m(r,o,f,p){var d;const P=(d=r.__r3f)==null?void 0:d.parent;if(!P)return;const v=n(o,f,r.__r3f.root);if(r.children){for(const l of r.children)l.__r3f&&i(v,l);r.children=r.children.filter(l=>!l.__r3f)}r.__r3f.objects.forEach(l=>i(v,l)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||h(P,r),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),i(P,v),v.raycast&&v.__r3f.eventCount&&v.__r3f.root.getState().internal.interaction.push(v),[p,p.alternate].forEach(l=>{l!==null&&(l.stateNode=v,l.ref&&(typeof l.ref=="function"?l.ref(v):l.ref.current=v))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:sn({createInstance:n,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const f=r.getState().scene;f.__r3f&&(f.__r3f.root=r,i(f,o))},removeChildFromContainer:(r,o)=>{o&&h(r.getState().scene,o)},insertInContainerBefore:(r,o,f)=>{if(!o||!f)return;const p=r.getState().scene;p.__r3f&&a(p,o,f)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,f,p){var d;if(((d=r==null?void 0:r.__r3f)!=null?d:{}).primitive&&p.object&&p.object!==r)return[!0];{const{args:v=[],children:l,...c}=p,{args:b=[],children:C,...M}=f;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((j,A)=>j!==b[A]))return[!0];const E=vt(r,c,M,!0);return E.changes.length?[!1,E]:null}},commitUpdate(r,[o,f],p,d,P,v){o?m(r,p,P,v):xe(r,f)},commitMount(r,o,f,p){var d;const P=(d=r.__r3f)!=null?d:{};r.raycast&&P.handlers&&P.eventCount&&r.__r3f.root.getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>oe(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:f,parent:p}=(o=r.__r3f)!=null?o:{};f&&p&&et(p,r,f),r.isObject3D&&(r.visible=!1),ie(r)},unhideInstance(r,o){var f;const{attach:p,parent:d}=(f=r.__r3f)!=null?f:{};p&&d&&Se(d,r,p),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),ie(r)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&z.fun(performance.now)?performance.now:z.fun(Date.now)?Date.now:()=>0,scheduleTimeout:z.fun(setTimeout)?setTimeout:void 0,cancelTimeout:z.fun(clearTimeout)?clearTimeout:void 0}),applyProps:xe}}var Ze,Ke;const Ce=e=>"colorSpace"in e||"outputColorSpace"in e,ct=()=>{var e;return(e=Be.ColorManagement)!=null?e:null},ut=e=>e&&e.isOrthographicCamera,gn=e=>e&&e.hasOwnProperty("current"),pe=typeof window<"u"&&((Ze=window.document)!=null&&Ze.createElement||((Ke=window.navigator)==null?void 0:Ke.product)==="ReactNative")?y.useLayoutEffect:y.useEffect;function ft(e){const t=y.useRef(e);return pe(()=>void(t.current=e),[e]),t}function yn({set:e}){return pe(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class dt extends y.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}dt.getDerivedStateFromError=()=>({error:!0});const pt="__default",Je=new Map,bn=e=>e&&!!e.memoized&&!!e.changes;function mt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ce=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},z={obj:e=>e===Object(e)&&!z.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(z.str(e)||z.num(e))return e===t;const u=z.obj(e);if(u&&i==="reference")return e===t;const h=z.arr(e);if(h&&n==="reference")return e===t;if((h||u)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(u&&n==="shallow"&&i==="shallow"){for(m in a?t:e)if(!z.equ(e[m],t[m],{strict:a,objects:"reference"}))return!1}else for(m in a?t:e)if(e[m]!==t[m])return!1;if(z.und(m)){if(h&&e.length===0&&t.length===0||u&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function wn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function _n(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function De(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return n=i.reduce((u,h)=>u[h],e),{target:n,key:a}}else return{target:n,key:t}}const Qe=/-\d+$/;function Se(e,t,n){if(z.str(n)){if(Qe.test(n)){const u=n.replace(Qe,""),{target:h,key:m}=De(e,u);Array.isArray(h[m])||(h[m]=[])}const{target:i,key:a}=De(e,n);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=n(e,t)}function et(e,t,n){var i,a;if(z.str(n)){const{target:u,key:h}=De(e,n),m=t.__r3f.previousAttach;m===void 0?delete u[h]:u[h]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function vt(e,{children:t,key:n,ref:i,...a},{children:u,key:h,ref:m,...s}={},g=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},f=Object.entries(a),p=[];if(g){const P=Object.keys(s);for(let v=0;v<P.length;v++)a.hasOwnProperty(P[v])||f.unshift([P[v],pt+"remove"])}f.forEach(([P,v])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&P==="object"||z.equ(v,s[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return p.push([P,v,!0,[]]);let c=[];P.includes("-")&&(c=P.split("-")),p.push([P,v,!1,c]);for(const b in a){const C=a[b];b.startsWith(`${P}-`)&&p.push([b,C,!1,b.split("-")])}});const d={...a};return o.memoizedProps&&o.memoizedProps.args&&(d.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(d.attach=o.memoizedProps.attach),{memoized:d,changes:p}}const En=typeof process<"u"&&!1;function xe(e,t){var n,i,a;const u=(n=e.__r3f)!=null?n:{},h=u.root,m=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:g}=bn(t)?t:vt(e,t),r=u.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let f=0;f<g.length;f++){let[p,d,P,v]=g[f];if(Ce(e)){const C="srgb",M="srgb-linear";p==="encoding"?(p="colorSpace",d=d===3001?C:M):p==="outputEncoding"&&(p="outputColorSpace",d=d===3001?C:M)}let l=e,c=l[p];if(v.length&&(c=v.reduce((b,C)=>b[C],e),!(c&&c.set))){const[b,...C]=v.reverse();l=C.reverse().reduce((M,E)=>M[E],e),p=b}if(d===pt+"remove")if(l.constructor){let b=Je.get(l.constructor);b||(b=new l.constructor,Je.set(l.constructor,b)),d=b[p]}else d=0;if(P)d?u.handlers[p]=d:delete u.handlers[p],u.eventCount=Object.keys(u.handlers).length;else if(c&&c.set&&(c.copy||c instanceof Ee)){if(Array.isArray(d))c.fromArray?c.fromArray(d):c.set(...d);else if(c.copy&&d&&d.constructor&&(En?c.constructor.name===d.constructor.name:c.constructor===d.constructor))c.copy(d);else if(d!==void 0){const b=c instanceof Bt;!b&&c.setScalar?c.setScalar(d):c instanceof Ee&&d instanceof Ee?c.mask=d.mask:c.set(d),!ct()&&!m.linear&&b&&c.convertSRGBToLinear()}}else if(l[p]=d,l[p]instanceof At&&l[p].format===Dt&&l[p].type===Lt){const b=l[p];Ce(b)&&Ce(m.gl)?b.colorSpace=m.gl.outputColorSpace:b.encoding=m.gl.outputEncoding}ie(e)}if(u.parent&&m.internal&&e.raycast&&r!==u.eventCount){const f=m.internal.interaction.indexOf(e);f>-1&&m.internal.interaction.splice(f,1),u.eventCount&&m.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(a=e.__r3f)!=null&&a.parent&&Le(e),e}function ie(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function Le(e){e.onUpdate==null||e.onUpdate(e)}function Pn(e,t){e.manual||(ut(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ge(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Mn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function ht(e,t,n,i){const a=n.get(t);a&&(n.delete(t),n.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function Cn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(a)}),n.capturedMap.forEach((i,a)=>{ht(n.capturedMap,t,i,a)})}function Sn(e){function t(s){const{internal:g}=e.getState(),r=s.offsetX-g.initialClick[0],o=s.offsetY-g.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(s){return s.filter(g=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(s,g){const r=e.getState(),o=new Set,f=[],p=g?g(r.internal.interaction):r.internal.interaction;for(let l=0;l<p.length;l++){const c=ce(p[l]);c&&(c.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(s,r);function d(l){const c=ce(l);if(!c||!c.events.enabled||c.raycaster.camera===null)return[];if(c.raycaster.camera===void 0){var b;c.events.compute==null||c.events.compute(s,c,(b=c.previousRoot)==null?void 0:b.getState()),c.raycaster.camera===void 0&&(c.raycaster.camera=null)}return c.raycaster.camera?c.raycaster.intersectObject(l,!0):[]}let P=p.flatMap(d).sort((l,c)=>{const b=ce(l.object),C=ce(c.object);return!b||!C?l.distance-c.distance:C.events.priority-b.events.priority||l.distance-c.distance}).filter(l=>{const c=ge(l);return o.has(c)?!1:(o.add(c),!0)});r.events.filter&&(P=r.events.filter(P,r));for(const l of P){let c=l.object;for(;c;){var v;(v=c.__r3f)!=null&&v.eventCount&&f.push({...l,eventObject:c}),c=c.parent}}if("pointerId"in s&&r.internal.capturedMap.has(s.pointerId))for(let l of r.internal.capturedMap.get(s.pointerId).values())o.has(ge(l.intersection))||f.push(l.intersection);return f}function a(s,g,r,o){const f=e.getState();if(s.length){const p={stopped:!1};for(const d of s){const P=ce(d.object)||f,{raycaster:v,pointer:l,camera:c,internal:b}=P,C=new V(l.x,l.y,0).unproject(c),M=L=>{var _,D;return(_=(D=b.capturedMap.get(L))==null?void 0:D.has(d.eventObject))!=null?_:!1},E=L=>{const _={intersection:d,target:g.target};b.capturedMap.has(L)?b.capturedMap.get(L).set(d.eventObject,_):b.capturedMap.set(L,new Map([[d.eventObject,_]])),g.target.setPointerCapture(L)},j=L=>{const _=b.capturedMap.get(L);_&&ht(b.capturedMap,d.eventObject,_,L)};let A={};for(let L in g){let _=g[L];typeof _!="function"&&(A[L]=_)}let R={...d,...A,pointer:l,intersections:s,stopped:p.stopped,delta:r,unprojectedPoint:C,ray:v.ray,camera:c,stopPropagation(){const L="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!L||L.has(d.eventObject))&&(R.stopped=p.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(_=>_.eventObject===d.eventObject))){const _=s.slice(0,s.indexOf(d));u([..._,d])}},target:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:j},currentTarget:{hasPointerCapture:M,setPointerCapture:E,releasePointerCapture:j},nativeEvent:g};if(o(R),p.stopped===!0)break}}return s}function u(s){const{internal:g}=e.getState();for(const r of g.hovered.values())if(!s.length||!s.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const f=r.eventObject.__r3f,p=f==null?void 0:f.handlers;if(g.hovered.delete(ge(r)),f!=null&&f.eventCount){const d={...r,intersections:s};p.onPointerOut==null||p.onPointerOut(d),p.onPointerLeave==null||p.onPointerLeave(d)}}}function h(s,g){for(let r=0;r<g.length;r++){const o=g[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function m(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>u([]);case"onLostPointerCapture":return g=>{const{internal:r}=e.getState();"pointerId"in g&&r.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(g.pointerId)&&(r.capturedMap.delete(g.pointerId),u([]))})}}return function(r){const{onPointerMissed:o,internal:f}=e.getState();f.lastEvent.current=r;const p=s==="onPointerMove",d=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",v=i(r,p?n:void 0),l=d?t(r):0;s==="onPointerDown"&&(f.initialClick=[r.offsetX,r.offsetY],f.initialHits=v.map(b=>b.eventObject)),d&&!v.length&&l<=2&&(h(r,f.interaction),o&&o(r)),p&&u(v);function c(b){const C=b.eventObject,M=C.__r3f,E=M==null?void 0:M.handlers;if(M!=null&&M.eventCount)if(p){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const j=ge(b),A=f.hovered.get(j);A?A.stopped&&b.stopPropagation():(f.hovered.set(j,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const j=E[s];j?(!d||f.initialHits.includes(C))&&(h(r,f.interaction.filter(A=>!f.initialHits.includes(A))),j(b)):d&&f.initialHits.includes(C)&&h(r,f.interaction.filter(A=>!f.initialHits.includes(A)))}}a(v,r,l,c)}}return{handlePointer:m}}const gt=e=>!!(e!=null&&e.render),yt=y.createContext(null),xn=(e,t)=>{const n=st((m,s)=>{const g=new V,r=new V,o=new V;function f(l=s().camera,c=r,b=s().size){const{width:C,height:M,top:E,left:j}=b,A=C/M;c instanceof V?o.copy(c):o.set(...c);const R=l.getWorldPosition(g).distanceTo(o);if(ut(l))return{width:C/l.zoom,height:M/l.zoom,top:E,left:j,factor:1,distance:R,aspect:A};{const L=l.fov*Math.PI/180,_=2*Math.tan(L/2)*R,D=_*(C/M);return{width:D,height:_,top:E,left:j,factor:C/D,distance:R,aspect:A}}}let p;const d=l=>m(c=>({performance:{...c.performance,current:l}})),P=new $t;return{set:m,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,c)=>t(l,c,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Xt,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();p&&clearTimeout(p),l.performance.current!==l.performance.min&&d(l.performance.min),p=setTimeout(()=>d(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:l=>m(c=>({...c,events:{...c.events,...l}})),setSize:(l,c,b,C,M)=>{const E=s().camera,j={width:l,height:c,top:C||0,left:M||0,updateStyle:b};m(A=>({size:j,viewport:{...A.viewport,...f(E,r,j)}}))},setDpr:l=>m(c=>{const b=mt(l);return{viewport:{...c.viewport,dpr:b,initialDpr:c.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const c=s().clock;c.stop(),c.elapsedTime=0,l!=="never"&&(c.start(),c.elapsedTime=0),m(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:y.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,c,b)=>{const C=s().internal;return C.priority=C.priority+(c>0?1:0),C.subscribers.push({ref:l,priority:c,store:b}),C.subscribers=C.subscribers.sort((M,E)=>M.priority-E.priority),()=>{const M=s().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(c>0?1:0),M.subscribers=M.subscribers.filter(E=>E.ref!==l))}}}}}),i=n.getState();let a=i.size,u=i.viewport.dpr,h=i.camera;return n.subscribe(()=>{const{camera:m,size:s,viewport:g,gl:r,set:o}=n.getState();if(s.width!==a.width||s.height!==a.height||g.dpr!==u){var f;a=s,u=g.dpr,Pn(m,s),r.setPixelRatio(g.dpr);const p=(f=s.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(s.width,s.height,p)}m!==h&&(h=m,o(p=>({viewport:{...p.viewport,...p.viewport.getCurrentViewport(m)}})))}),n.subscribe(m=>e(m)),n};let ye,On=new Set,Rn=new Set,Tn=new Set;function Oe(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function ue(e,t){switch(e){case"before":return Oe(On,t);case"after":return Oe(Rn,t);case"tail":return Oe(Tn,t)}}let Re,Te;function je(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Re=t.internal.subscribers,ye=0;ye<Re.length;ye++)Te=Re[ye],Te.ref.current(Te.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function jn(e){let t=!1,n,i,a;function u(s){i=requestAnimationFrame(u),t=!0,n=0,ue("before",s);for(const r of e.values()){var g;a=r.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((g=a.gl.xr)!=null&&g.isPresenting)&&(n+=je(s,a))}if(ue("after",s),n===0)return ue("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,g=1){var r;if(!s)return e.forEach(o=>h(o.store.getState()),g);(r=s.gl.xr)!=null&&r.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+g),t||(t=!0,requestAnimationFrame(u)))}function m(s,g=!0,r,o){if(g&&ue("before",s),r)je(s,r,o);else for(const f of e.values())je(s,f.store.getState());g&&ue("after",s)}return{loop:u,invalidate:h,advance:m}}function bt(){const e=y.useContext(yt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function q(e=n=>n,t){return bt()(e,t)}function $e(e,t=0){const n=bt(),i=n.getState().internal.subscribe,a=ft(e);return pe(()=>i(a,t,n),[t,i,n]),null}const tt=new WeakMap;function wt(e,t){return function(n,...i){let a=tt.get(n);return a||(a=new n,tt.set(n,a)),e&&e(a),Promise.all(i.map(u=>new Promise((h,m)=>a.load(u,s=>{s.scene&&Object.assign(s,wn(s.scene)),h(s)},t,s=>m(new Error(`Could not load ${u}: ${s==null?void 0:s.message}`)))))).finally(()=>a.dispose==null?void 0:a.dispose())}}function J(e,t,n,i){const a=Array.isArray(t)?t:[t],u=dn(wt(n,i),[e,...a],{equal:z.equ});return Array.isArray(t)?u:u[0]}J.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return pn(wt(n),[e,...i])};J.clear=function(e,t){const n=Array.isArray(t)?t:[t];return mn([e,...n])};const ae=new Map,{invalidate:nt,advance:rt}=jn(ae),{reconciler:we,applyProps:Y}=hn(ae,Mn),re={objects:"shallow",strict:!1},kn=(e,t)=>{const n=typeof e=="function"?e(t):e;return gt(n)?n:new Nt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function An(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:u,left:h,updateStyle:m=n}=t;return{width:i,height:a,top:u,left:h,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:u,left:h}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:u,left:h,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function Dn(e){const t=ae.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,u=i||xn(nt,rt),h=n||we.createContainer(u,se.ConcurrentRoot,null,!1,null,"",a,null);t||ae.set(e,{fiber:h,store:u});let m,s=!1,g;return{configure(r={}){let{gl:o,size:f,scene:p,events:d,onCreated:P,shadows:v=!1,linear:l=!1,flat:c=!1,legacy:b=!1,orthographic:C=!1,frameloop:M="always",dpr:E=[1,2],performance:j,raycaster:A,camera:R,onPointerMissed:L}=r,_=u.getState(),D=_.gl;_.gl||_.set({gl:D=kn(o,e)});let B=_.raycaster;B||_.set({raycaster:B=new Ft});const{params:X,...H}=A||{};if(z.equ(H,B,re)||Y(B,{...H}),z.equ(X,B.params,re)||Y(B,{params:{...B.params,...X}}),!_.camera||_.camera===g&&!z.equ(g,R,re)){g=R;const O=R instanceof Gt,k=O?R:C?new Ie(0,0,0,0,.1,1e3):new ze(75,0,.1,1e3);O||(k.position.z=5,R&&Y(k,R),!_.camera&&!(R!=null&&R.rotation)&&k.lookAt(0,0,0)),_.set({camera:k}),B.camera=k}if(!_.scene){let O;p instanceof Xe?O=p:(O=new Xe,p&&Y(O,p)),_.set({scene:oe(O)})}if(!_.xr){var N;const O=(F,U)=>{const Z=u.getState();Z.frameloop!=="never"&&rt(F,!0,Z,U)},k=()=>{const F=u.getState();F.gl.xr.enabled=F.gl.xr.isPresenting,F.gl.xr.setAnimationLoop(F.gl.xr.isPresenting?O:null),F.gl.xr.isPresenting||nt(F)},$={connect(){const F=u.getState().gl;F.xr.addEventListener("sessionstart",k),F.xr.addEventListener("sessionend",k)},disconnect(){const F=u.getState().gl;F.xr.removeEventListener("sessionstart",k),F.xr.removeEventListener("sessionend",k)}};typeof((N=D.xr)==null?void 0:N.addEventListener)=="function"&&$.connect(),_.set({xr:$})}if(D.shadowMap){const O=D.shadowMap.enabled,k=D.shadowMap.type;if(D.shadowMap.enabled=!!v,z.boo(v))D.shadowMap.type=Pe;else if(z.str(v)){var W;const $={basic:qt,percentage:Ut,soft:Pe,variance:Vt};D.shadowMap.type=(W=$[v])!=null?W:Pe}else z.obj(v)&&Object.assign(D.shadowMap,v);(O!==D.shadowMap.enabled||k!==D.shadowMap.type)&&(D.shadowMap.needsUpdate=!0)}const w=ct();w&&("enabled"in w?w.enabled=!b:"legacyMode"in w&&(w.legacyMode=b)),Y(D,{outputEncoding:l?3e3:3001,toneMapping:c?It:zt}),_.legacy!==b&&_.set(()=>({legacy:b})),_.linear!==l&&_.set(()=>({linear:l})),_.flat!==c&&_.set(()=>({flat:c})),o&&!z.fun(o)&&!gt(o)&&!z.equ(o,D,re)&&Y(D,o),d&&!_.events.handlers&&_.set({events:d(u)});const T=An(e,f);return z.equ(T,_.size,re)||_.setSize(T.width,T.height,T.updateStyle,T.top,T.left),E&&_.viewport.dpr!==mt(E)&&_.setDpr(E),_.frameloop!==M&&_.setFrameloop(M),_.onPointerMissed||_.set({onPointerMissed:L}),j&&!z.equ(j,_.performance,re)&&_.set(O=>({performance:{...O.performance,...j}})),m=P,s=!0,this},render(r){return s||this.configure(),we.updateContainer(y.createElement(Ln,{store:u,children:r,onCreated:m,rootElement:e}),h,null,()=>{}),u},unmount(){_t(e)}}}function Ln({store:e,children:t,onCreated:n,rootElement:i}){return pe(()=>{const a=e.getState();a.set(u=>({internal:{...u.internal,active:!0}})),n&&n(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),y.createElement(yt.Provider,{value:e},t)}function _t(e,t){const n=ae.get(e),i=n==null?void 0:n.fiber;if(i){const a=n==null?void 0:n.store.getState();a&&(a.internal.active=!1),we.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var u,h,m,s;a.events.disconnect==null||a.events.disconnect(),(u=a.gl)==null||(h=u.renderLists)==null||h.dispose==null||h.dispose(),(m=a.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),_n(a),ae.delete(e),t&&t(e)}catch{}},500)})}}we.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:y.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Fn(e){const{handlePointer:t}=Sn(e);return{priority:1,enabled:!0,compute(n,i,a){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:a}=e.getState();(n=a.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:n=>{var i;const{set:a,events:u}=e.getState();u.disconnect==null||u.disconnect(),a(h=>({events:{...h.events,connected:n}})),Object.entries((i=u.handlers)!=null?i:[]).forEach(([h,m])=>{const[s,g]=ke[h];n.addEventListener(s,m,{passive:g})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([u,h])=>{if(i&&i.connected instanceof HTMLElement){const[m]=ke[u];i.connected.removeEventListener(m,h)}}),n(u=>({events:{...u.events,connected:void 0}}))}}}}const In=y.forwardRef(function({children:t,fallback:n,resize:i,style:a,gl:u,events:h=Fn,eventSource:m,eventPrefix:s,shadows:g,linear:r,flat:o,legacy:f,orthographic:p,frameloop:d,dpr:P,performance:v,raycaster:l,camera:c,scene:b,onPointerMissed:C,onCreated:M,...E},j){y.useMemo(()=>vn(Yt),[]);const A=on(),[R,L]=nn({scroll:!0,debounce:{scroll:50,resize:0},...i}),_=y.useRef(null),D=y.useRef(null);y.useImperativeHandle(j,()=>_.current);const B=ft(C),[X,H]=y.useState(!1),[N,W]=y.useState(!1);if(X)throw X;if(N)throw N;const w=y.useRef(null);pe(()=>{const S=_.current;L.width>0&&L.height>0&&S&&(w.current||(w.current=Dn(S)),w.current.configure({gl:u,events:h,shadows:g,linear:r,flat:o,legacy:f,orthographic:p,frameloop:d,dpr:P,performance:v,raycaster:l,camera:c,scene:b,size:L,onPointerMissed:(...T)=>B.current==null?void 0:B.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(m?gn(m)?m.current:m:D.current),s&&T.setEvents({compute:(O,k)=>{const $=O[s+"X"],F=O[s+"Y"];k.pointer.set($/k.size.width*2-1,-(F/k.size.height)*2+1),k.raycaster.setFromCamera(k.pointer,k.camera)}}),M==null||M(T)}}),w.current.render(y.createElement(A,null,y.createElement(dt,{set:W},y.createElement(y.Suspense,{fallback:y.createElement(yn,{set:H})},t)))))}),y.useEffect(()=>{const S=_.current;if(S)return()=>_t(S)},[]);const x=m?"none":"auto";return y.createElement("div",de({ref:D,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:x,...a}},E),y.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},y.createElement("canvas",{ref:_,style:{display:"block"}},n)))}),lr=y.forwardRef(function(t,n){return y.createElement(rn,null,y.createElement(In,de({},t,{ref:n})))}),me=new V,Ne=new V,zn=new V;function Hn(e,t,n){const i=me.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=n.width/2,u=n.height/2;return[i.x*a+a,-(i.y*u)+u]}function Wn(e,t){const n=me.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),a=n.sub(i),u=t.getWorldDirection(zn);return a.angleTo(u)>Math.PI/2}function Bn(e,t,n,i){const a=me.setFromMatrixPosition(e.matrixWorld),u=a.clone();u.project(t),n.setFromCamera(u,t);const h=n.intersectObjects(i,!0);if(h.length){const m=h[0].distance;return a.distanceTo(n.ray.origin)<m}return!0}function $n(e,t){if(t instanceof Ie)return t.zoom;if(t instanceof ze){const n=me.setFromMatrixPosition(e.matrixWorld),i=Ne.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,u=n.distanceTo(i);return 1/(2*Math.tan(a/2)*u)}else return 1}function Nn(e,t,n){if(t instanceof ze||t instanceof Ie){const i=me.setFromMatrixPosition(e.matrixWorld),a=Ne.setFromMatrixPosition(t.matrixWorld),u=i.distanceTo(a),h=(n[1]-n[0])/(t.far-t.near),m=n[1]-h*t.far;return Math.round(h*u+m)}}const Fe=e=>Math.abs(e)<1e-10?0:e;function Et(e,t,n=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=Fe(t[a]*e.elements[a])+(a!==15?",":")");return n+i}const Gn=(e=>t=>Et(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),qn=(e=>(t,n)=>Et(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Un(e){return e&&typeof e=="object"&&"current"in e}const cr=y.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:a,center:u,fullscreen:h,portal:m,distanceFactor:s,sprite:g=!1,transform:r=!1,occlude:o,onOcclude:f,castShadow:p,receiveShadow:d,material:P,geometry:v,zIndexRange:l=[16777271,0],calculatePosition:c=Hn,as:b="div",wrapperClass:C,pointerEvents:M="auto",...E},j)=>{const{gl:A,camera:R,scene:L,size:_,raycaster:D,events:B,viewport:X}=q(),[H]=y.useState(()=>document.createElement(b)),N=y.useRef(),W=y.useRef(null),w=y.useRef(0),x=y.useRef([0,0]),S=y.useRef(null),T=y.useRef(null),O=(m==null?void 0:m.current)||B.connected||A.domElement.parentNode,k=y.useRef(null),$=y.useRef(!1),F=y.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Un(o[0]),[o]);y.useLayoutEffect(()=>{const G=A.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(l[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),y.useLayoutEffect(()=>{if(W.current){const G=N.current=an(H);if(L.updateMatrixWorld(),r)H.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const I=c(W.current,R,_);H.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${I[0]}px,${I[1]}px,0);transform-origin:0 0;`}return O&&(a?O.prepend(H):O.appendChild(H)),()=>{O&&O.removeChild(H),G.unmount()}}},[O,r]),y.useLayoutEffect(()=>{C&&(H.className=C)},[C]);const U=y.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:u?"translate3d(-50%,-50%,0)":"none",...h&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...n},[n,u,h,_,r]),Z=y.useMemo(()=>({position:"absolute",pointerEvents:M}),[M]);y.useLayoutEffect(()=>{if($.current=!1,r){var G;(G=N.current)==null||G.render(y.createElement("div",{ref:S,style:U},y.createElement("div",{ref:T,style:Z},y.createElement("div",{ref:j,className:i,style:n,children:e}))))}else{var I;(I=N.current)==null||I.render(y.createElement("div",{ref:j,style:U,className:i,children:e}))}});const ne=y.useRef(!0);$e(G=>{if(W.current){R.updateMatrixWorld(),W.current.updateWorldMatrix(!0,!1);const I=r?x.current:c(W.current,R,_);if(r||Math.abs(w.current-R.zoom)>t||Math.abs(x.current[0]-I[0])>t||Math.abs(x.current[1]-I[1])>t){const Q=Wn(W.current,R);let K=!1;F&&(Array.isArray(o)?K=o.map(ee=>ee.current):o!=="blending"&&(K=[L]));const le=ne.current;if(K){const ee=Bn(W.current,R,D,K);ne.current=ee&&!Q}else ne.current=!Q;le!==ne.current&&(f?f(!ne.current):H.style.display=ne.current?"block":"none");const ve=Math.floor(l[0]/2),St=o?F?[l[0],ve]:[ve-1,0]:l;if(H.style.zIndex=`${Nn(W.current,R,St)}`,r){const[ee,Ue]=[_.width/2,_.height/2],_e=R.projectionMatrix.elements[5]*Ue,{isOrthographicCamera:Ve,top:xt,left:Ot,bottom:Rt,right:Tt}=R,jt=Gn(R.matrixWorldInverse),kt=Ve?`scale(${_e})translate(${Fe(-(Tt+Ot)/2)}px,${Fe((xt+Rt)/2)}px)`:`translateZ(${_e}px)`;let te=W.current.matrixWorld;g&&(te=R.matrixWorldInverse.clone().transpose().copyPosition(te).scale(W.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),H.style.width=_.width+"px",H.style.height=_.height+"px",H.style.perspective=Ve?"":`${_e}px`,S.current&&T.current&&(S.current.style.transform=`${kt}${jt}translate(${ee}px,${Ue}px)`,T.current.style.transform=qn(te,1/((s||10)/400)))}else{const ee=s===void 0?1:$n(W.current,R)*s;H.style.transform=`translate3d(${I[0]}px,${I[1]}px,0) scale(${ee})`}x.current=I,w.current=R.zoom}}if(!F&&k.current&&!$.current)if(r){if(S.current){const I=S.current.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const{isOrthographicCamera:Q}=R;if(Q||v)E.scale&&(Array.isArray(E.scale)?E.scale instanceof V?k.current.scale.copy(E.scale.clone().divideScalar(1)):k.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):k.current.scale.setScalar(1/E.scale));else{const K=(s||10)/400,le=I.clientWidth*K,ve=I.clientHeight*K;k.current.scale.set(le,ve,1)}$.current=!0}}}else{const I=H.children[0];if(I!=null&&I.clientWidth&&I!=null&&I.clientHeight){const Q=1/X.factor,K=I.clientWidth*Q,le=I.clientHeight*Q;k.current.scale.set(K,le,1),$.current=!0}k.current.lookAt(G.camera.position)}});const qe=y.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return y.createElement("group",de({},E,{ref:W}),o&&!F&&y.createElement("mesh",{castShadow:p,receiveShadow:d,ref:k},v||y.createElement("planeGeometry",null),P||y.createElement("shaderMaterial",{side:Zt,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))});let fe=0;const ur=st(e=>(he.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-fe)/(i-fe)*100})},he.onLoad=()=>{e({active:!1})},he.onError=t=>e(n=>({errors:[...n.errors,t]})),he.onProgress=(t,n,i)=>{n===i&&(fe=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-fe)/(i-fe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ot=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Pt(e,t){const n=q(a=>a.gl),i=J(He,ot(e)?Object.values(e):e);if(y.useLayoutEffect(()=>{t==null||t(i)},[t]),y.useEffect(()=>{"initTexture"in n&&(Array.isArray(i)?i:[i]).forEach(n.initTexture)},[n,i]),ot(e)){const a={};let u=0;for(const h in e)a[h]=i[u++];return a}else return i}Pt.preload=e=>J.preload(He,e);Pt.clear=e=>J.clear(He,e);function Vn(e){return Array.isArray(e)}function Ae(e=[0,0,0]){return Vn(e)?e:e instanceof V||e instanceof it?[e.x,e.y,e.z]:[e,e,e]}const fr=y.forwardRef(function({debug:t,depthTest:n=!1,polygonOffsetFactor:i=-10,map:a,mesh:u,children:h,position:m,rotation:s,scale:g,...r},o){const f=y.useRef(null);y.useImperativeHandle(o,()=>f.current);const p=y.useRef(null);return y.useLayoutEffect(()=>{const d=(u==null?void 0:u.current)||f.current.parent,P=f.current;if(!(d instanceof Kt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const v={position:new V,rotation:new it,scale:new V(1,1,1)};if(d){Y(v,{position:m,scale:g});const l=d.matrixWorld.clone();if(d.matrixWorld.identity(),!s||typeof s=="number"){const c=new Jt;c.position.copy(v.position),c.lookAt(d.position),typeof s=="number"&&c.rotateZ(s),Y(v,{rotation:c.rotation})}else Y(v,{rotation:s});return P.geometry=new ln(d,v.position,v.rotation,v.scale),p.current&&(Y(p.current,v),p.current.traverse(c=>c.raycast=()=>null)),d.matrixWorld=l,()=>{P.geometry.dispose()}}},[u,...Ae(m),...Ae(g),...Ae(s)]),y.createElement("mesh",de({ref:f,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":n,"material-map":a},r),h,t&&y.createElement("mesh",{ref:p},y.createElement("boxGeometry",null),y.createElement("meshNormalMaterial",{wireframe:!0}),y.createElement("axesHelper",null)))});let be=null,Mt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Ct(e,t,n){return i=>{n&&n(i),e&&(be||(be=new cn),be.setDecoderPath(typeof e=="string"?e:Mt),i.setDRACOLoader(be)),t&&i.setMeshoptDecoder(typeof Me=="function"?Me():Me)}}function Ge(e,t=!0,n=!0,i){return J(We,e,Ct(t,n,i))}Ge.preload=(e,t=!0,n=!0,i)=>J.preload(We,e,Ct(t,n,i));Ge.clear=e=>J.clear(We,e);Ge.setDecoderPath=e=>{Mt=e};const dr=y.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:a=!0,keyEvents:u=!1,onChange:h,onStart:m,onEnd:s,...g},r)=>{const o=q(E=>E.invalidate),f=q(E=>E.camera),p=q(E=>E.gl),d=q(E=>E.events),P=q(E=>E.setEvents),v=q(E=>E.set),l=q(E=>E.get),c=q(E=>E.performance),b=t||f,C=i||d.connected||p.domElement,M=y.useMemo(()=>new un(b),[b]);return $e(()=>{M.enabled&&M.update()},-1),y.useEffect(()=>(u&&M.connect(u===!0?C:u),M.connect(C),()=>void M.dispose()),[u,C,n,M,o]),y.useEffect(()=>{const E=R=>{o(),n&&c.regress(),h&&h(R)},j=R=>{m&&m(R)},A=R=>{s&&s(R)};return M.addEventListener("change",E),M.addEventListener("start",j),M.addEventListener("end",A),()=>{M.removeEventListener("start",j),M.removeEventListener("end",A),M.removeEventListener("change",E)}},[h,m,s,M,o,P]),y.useEffect(()=>{if(e){const E=l().controls;return v({controls:M}),()=>v({controls:E})}},[e,M]),y.createElement("primitive",de({ref:r,object:M,enableDamping:a},g))}),pr=y.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:i=1,floatIntensity:a=1,floatingRange:u=[-.1,.1],...h},m)=>{const s=y.useRef(null),g=y.useRef(Math.random()*1e4);return $e(r=>{var o,f;if(!t||n===0)return;const p=g.current+r.clock.getElapsedTime();s.current.rotation.x=Math.cos(p/4*n)/8*i,s.current.rotation.y=Math.sin(p/4*n)/8*i,s.current.rotation.z=Math.sin(p/4*n)/20*i;let d=Math.sin(p/4*n)/10;d=Qt.mapLinear(d,-.1,.1,(o=u==null?void 0:u[0])!==null&&o!==void 0?o:-.1,(f=u==null?void 0:u[1])!==null&&f!==void 0?f:.1),s.current.position.y=d*a,s.current.updateMatrix()}),y.createElement("group",h,y.createElement("group",{ref:fn([s,m]),matrixAutoUpdate:!1},e))});function mr({all:e,scene:t,camera:n}){const i=q(({gl:h})=>h),a=q(({camera:h})=>h),u=q(({scene:h})=>h);return y.useLayoutEffect(()=>{const h=[];e&&(t||u).traverse(g=>{g.visible===!1&&(h.push(g),g.visible=!0)}),i.compile(t||u,n||a);const m=new en(128);new tn(.01,1e5,m).update(i,t||u),m.dispose(),h.forEach(g=>g.visible=!1)},[]),null}export{lr as C,fr as D,pr as F,cr as H,dr as O,mr as P,ar as a,Ge as b,ir as c,Pt as d,sr as g,ur as u};
